/* --- Contenitore pagina Lobby --- */
.lobby-page {
  margin: 0;
  min-height: 100vh;
  width: 100%;
  display: flex;
  justify-content: center; 
  align-items: center;     
  color: #f0f0f0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  background-size: cover;
  background-position: center;
}

/* =========================================
   LAYOUT PC A 4 RIGHE (CORRETTO)
   ========================================= */
.lobby-layout {
  display: grid;
  grid-template-columns: 1fr 1fr; 
  grid-template-rows: auto auto auto 1fr;   
  gap: 15px;
  
  /* MODIFICA QUI: PIÙ LARGO */
  width: 98%;          /* Occupa quasi tutto lo schermo */
  max-width: 1600px;   /* Limite massimo aumentato */
  height: 85vh;
  
  padding: 2rem;
  background-color: #171819;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(143, 64, 159, 0.6);
  border: 1px solid #444;
  box-sizing: border-box;
}

/* --- RIGA 1: TITOLO ESTERNO --- */
.lobby-header-external {
    grid-column: span 2;
    grid-row: 1; /* <--- IMPORTANTE: Sta alla riga 1 */
    
    text-align: center;
    font-size: 0.9rem;
    color: #888;
    letter-spacing: 4px;
    font-weight: 800;
    text-transform: uppercase;
    margin-bottom: 5px; 
    background: -webkit-linear-gradient(45deg, #ffffff, #d946ff);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    filter: drop-shadow(0px 2px 4px rgba(0,0,0,0.5));
}

/* --- RIGA 2: ZONA SUPERIORE (CARD) --- */
.lobby-card {
  grid-column: span 2; 
  grid-row: 2; /* <--- IMPORTANTE: Scende alla riga 2 */
  
  background-color: #1f2022;
  border-radius: 12px;
  padding: 1rem 2rem;
  border: 1px solid #444;
  
  display: flex;
  flex-direction: row; 
  align-items: center;
  justify-content: space-between; 
  gap: 2rem;
}

/* (Il resto degli stili interni alla card rimangono uguali) */
.lobby-info-group {
    display: flex;
    flex-direction: column; 
    align-items: flex-start; 
    gap: 0.2rem; 
}

.room-name-display {
  font-size: 2.2rem; 
  margin: 0;
  color: #ffffff;
  white-space: nowrap;
  line-height: 1.2; 
  background: -webkit-linear-gradient(45deg, #ffffff, #d946ff);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    filter: drop-shadow(0px 2px 4px rgba(0,0,0,0.5));
}

.room-code-line {
    margin: 0;
    font-size: 0.9rem;
    color: #ccc;
    font-weight: 400;

    /* --- MODIFICHE PER RIGA SINGOLA --- */
    white-space: nowrap;  /* Impedisce TASSATIVAMENTE di andare a capo */
    
    display: flex;        /* Mantiene testo e span sulla stessa linea */
    flex-direction: row;
    align-items: center;  /* Allinea verticalmente il testo col codice */
}

.code-highlight {
  font-size: 1rem;
  color: #d249ff; 
  font-weight: bold;
  margin-left: 5px;
  letter-spacing: 1px;
}

.lobby-buttons {
  margin-top: 0;
  display: flex;
  flex-direction: row;
  gap: 1rem;
}

/* --- RIGA 3: BARRA DI STATO --- */
.lobby-status-bar {
    grid-column: span 2; 
    grid-row: 3; /* <--- IMPORTANTE: Scende alla riga 3 */
    
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 5px 0;
}

.lobby-subtitle {
  margin: 0;
  font-size: 1.1rem; 
  color: #ccc;
  font-style: italic;
  letter-spacing: 0.5px;
}

/* --- RIGA 4 (Colonna SX): LISTA GIOCATORI --- */
.lobby-sidebar {
  grid-column: 1; 
  grid-row: 4; /* <--- IMPORTANTE: Scende alla riga 4 */
  
  width: 100%;
  background-color: #171819;
  border-radius: 12px;
  padding: 1.5rem;
  border: 1px solid #444;
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.sidebar-players {
  flex: 1;
  overflow-y: auto;
  margin-top: 1rem;
  padding-right: 5px;
}

/* --- RIGA 4 (Colonna DX): CHAT --- */
.lobby-chat-column {
  grid-column: 2; 
  grid-row: 4; /* <--- IMPORTANTE: Scende alla riga 4 */
  
  display: flex;
  flex-direction: column;
  height: 100%;
}

.chat-container {
  flex: 1;
  display: flex;
  flex-direction: column;
  border: 1px solid #444;
  border-radius: 12px;
  padding: 1rem;
  background-color: #171819;
  height: 100%;
}

/* --- AREA MESSAGGI (SFONDO TIPO WHATSAPP) --- */
.chat-messages {
  flex: 1;
  overflow-y: auto;
  padding: 1rem;
  margin-bottom: 1rem;
  border-radius: 8px;
  max-height: none;

  /* SFONDO GANG.JPG CON PATINA SCURA */
  background: 
    /* 1. Patina scura (per leggere il testo) */
    linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)),
    /* 2. L'immagine vera e propria */
    url('../../imgs/gang.jpg') center/cover no-repeat;
    
  /* Bordo sottile per staccare */
  border: 1px solid #444;
}

/* --- BOTTONI COLORATI --- */
/* Stile Base Comune */
.lobby-main-btn {
  height: 55px; /* Altezza fissa per tutti */
  
  /* Centratura */
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 0 10px;
  
  border-radius: 8px;
  border: none;
  font-weight: 600;
  cursor: pointer;
  white-space: nowrap;
  
  transition: transform 0.1s, background-color 0.2s;
}

.lobby-main-btn:active {
    transform: scale(0.95);
}

/* 1. BOTTONE AZIONE PRINCIPALE (Pronto / Admin) - GRANDE */
.lobby-main-btn.player-btn,
.lobby-main-btn.admin-btn {
    width: 280px;      /* Molto largo */
    font-size: 1.2rem; /* Testo più grande */
    letter-spacing: 0.5px;
}

/* Colori Player */
.lobby-main-btn.player-btn { background-color: #a600ff; color: white; }
.lobby-main-btn.player-btn:hover { background-color: #d249ff; }
.lobby-main-btn.player-btn.ready { background-color: #4CAF50; } /* Verde quando pronto */

/* Colori Admin */
.lobby-main-btn.admin-btn { background-color: #2196F3; color: white; }
.lobby-main-btn.admin-btn:hover:not(:disabled) { background-color: #1976D2; }
.lobby-main-btn.admin-btn:disabled { background-color: #555; color: #999; }


/* 2. BOTTONE SECONDARIO (Esci) - PICCOLO */
.lobby-main-btn.exit-btn {
    width: 140px;      /* Più stretto */
    font-size: 1.2rem; /* Testo normale */
    background-color: #ff4444; 
    color: white;
    opacity: 0.8;      /* Leggermente meno evidente */
}

.lobby-main-btn.exit-btn:hover {
    background-color: #cc0000;
    opacity: 1;
}


/* --- CHAT STYLES --- */
.chat-input-form { display: flex; gap: 0.5rem; }
.chat-input {
  flex: 1; padding: 12px; border-radius: 8px; border: 1px solid #555;
  background-color: #333; color: white; outline: none;
}
.chat-input:focus { border-color: #d946ff; }
/* --- STILE PLACEHOLDER CHAT --- */

/* 1. Aspetto normale (quando NON ci clicchi) */
.chat-input::placeholder {
    color: #888;          /* Colore grigio chiaro */
    font-style: italic;   /* Corsivo per stile */
    opacity: 1;           /* Visibile */
    transition: opacity 0.2s ease; /* Effetto dissolvenza */
}

/* 2. QUANDO CLICCHI (FOCUS) -> SPARISCE */
.chat-input:focus::placeholder {
    color: transparent;
    opacity: 0;
}
.chat-send-btn {
  padding: 0 25px; border-radius: 8px; border: none;
  background-color: #a600ff; color: white; font-weight: bold; cursor: pointer;
}

.chat-message { margin-bottom: 5px; font-size: 0.95rem; }
.chat-from { color: #d249ff; font-weight: bold; margin-right: 5px; }
.chat-message-system { color: #888; font-style: italic; }

.sidebar-player {
  display: flex; align-items: center; gap: 10px; padding: 10px;
  border-radius: 8px; margin-bottom: 8px; background-color: rgba(255,255,255,0.05);
}
.sidebar-player-me { border: 1px solid #d249ff; background-color: rgba(217, 73, 255, 0.1); }
.sidebar-player-avatar {
  width: 32px; height: 32px; border-radius: 50%; background: #a600ff;
  display: flex; align-items: center; justify-content: center; font-weight: bold;
}

/* Sfondo scuro */
.pixel-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.85);
    z-index: 10000;
    display: flex;
    justify-content: center;
    align-items: center;
    animation: fadeIn 0.2s ease-out;
    /* Forza il rendering pixelato se ci fossero immagini */
    image-rendering: pixelated; 
}

/* La Nuvoletta Bianca - BORDI PIÙ SPESSI */
.pixel-bubble {
    background-color: #fff;
    color: #000;
    padding: 1.5rem; /* Più spazio interno */
    position: relative;
    font-family: 'Courier New', Courier, monospace; 
    text-align: center;
    max-width: 70%;
    width: 380px;
    
    /* TRUCCO CSS MODIFICATO: Pixel base raddoppiato (da 4px a 8px) */
    box-shadow: 
        /* Strato interno bianco per smussare */
        -8px 0 0 0 white, 
        8px 0 0 0 white, 
        0 -8px 0 0 rgb(234, 231, 231), 
        0 8px 0 0 white, 
        /* Bordo nero esterno bello grosso */
        -16px 0 0 0 rgb(66, 63, 63), 
        16px 0 0 0 black, 
        0 -16px 0 0 black, 
        0 16px 0 0 rgb(66, 63, 63);
        
    margin: 20px; /* Aumentato margine per compensare il bordo più grosso */
}

/* La coda della nuvoletta (il triangolo sotto) - RIFATTA PIÙ GROSSA */
.pixel-bubble::after {
    content: "";
    position: absolute;
    bottom: -50px; /* Posizione più in basso */
    left: 25%;
    width: 0;
    height: 0;
    
    /* Triangolo più grande */
    border-left: 50px solid transparent;
    border-right: 5px solid transparent;
    border-top: 50px solid #fff;
    
    /* Ombra pixelata nera spessa */
    filter: drop-shadow(-8px 8px 0 black);
    z-index: 1;
}

/* Scritta "WHAT?" */
.pixel-title {
    font-size: 3.5rem; /* Ancora più grande */
    font-weight: 900;
    margin: 0;
    line-height: 1;
    letter-spacing: -3px;
    text-transform: uppercase;
    text-shadow: 4px 4px 0 #ccc; /* Ombra pixelata grigia sul testo */
}

.pixel-subtitle {
    font-size: 1.2rem;
    font-weight: bold;
    margin-top: 15px;
    margin-bottom: 30px;
    color: #333;
    text-transform: uppercase; /* Sottotitolo maiuscolo per stile retro */
}

/* Gruppo bottoni */
.pixel-buttons {
    display: flex;
    gap: 20px;
    justify-content: center;
}

/* Bottoni stile retro - GRIGI */
.pixel-btn {
    font-family: 'Courier New', Courier, monospace;
    font-weight: 900;
    font-size: 1rem;
    padding: 10px 20px;
    cursor: pointer;
    text-transform: uppercase;
    transition: transform 0.1s, background-color 0.1s;
    
    /* Bordo nero spesso */
    border: 4px solid black;
    /* Ombra solida per effetto 3D retro */
    box-shadow: 4px 4px 0 black;
}

.pixel-btn:active {
    transform: translate(4px, 4px); /* Si sposta giù a destra quando premuto */
    box-shadow: 0px 0px 0 black; /* L'ombra sparisce */
}

/* Tasto SI (Grigio Scuro) */
.pixel-btn.yes {
    background-color: #999; 
    color: white;
}
.pixel-btn.yes:hover { background-color: #777; }

/* Tasto NO (Grigio Chiaro) */
.pixel-btn.no {
    background-color: #ccc; 
    color: black;
}
.pixel-btn.no:hover { background-color: #bbb; }

@keyframes fadeIn {
    from { opacity: 0; transform: scale(0.9); }
    to { opacity: 1; transform: scale(1); }
}

/* =========================================
   RETRO ERROR POPUP (Windows 95/98 Style)
   ========================================= */

/* 1. L'Overlay che blocca lo schermo */
.janus-error-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.4); /* Sfondo leggermente oscurato */
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 100000; /* Altissimo livello */
}

/* 2. La Finestra Grigia (Il Box) */
.janus-error-popup {
    background-color: #c0c0c0; /* Il classico grigio Windows */
    width: min(400px, 90vw);
    
    /* EFFETTO 3D RETRO (Bordi) */
    border-top: 2px solid #dfdfdf;
    border-left: 2px solid #dfdfdf;
    border-right: 2px solid #000000;
    border-bottom: 2px solid #000000;
    box-shadow: 2px 2px 0 #808080; /* Doppia ombra per profondità */
    
    padding: 3px; /* Spazio per incorniciare la barra blu */
    display: flex;
    flex-direction: column;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* Font sistema */
}

/* 3. La Barra del Titolo Blu */
.popup-header {
    background: linear-gradient(90deg, #000080, #1084d0); /* Gradiente blu Windows 98 */
    color: white;
    padding: 4px 6px;
    font-size: 14px;
    font-weight: bold;
    display: flex;
    justify-content: space-between;
    align-items: center;
    letter-spacing: 0.5px;
}

/* 4. Il corpo del messaggio */
.popup-body {
    padding: 20px 15px;
    color: black;
    display: flex;
    flex-direction: column;
    gap: 10px;
    align-items: flex-start; /* Allinea a sinistra */
    
    /* Aggiungiamo l'icona ERRORE ROSSA (Il cerchio con la X bianca) */
    position: relative;
    padding-left: 60px; /* Spazio per l'icona */
    min-height: 50px;
}

/* Creiamo l'icona rossa via CSS */
.popup-body::before {
    content: "✖"; /* X bianca */
    position: absolute;
    left: 15px;
    top: 20px;
    width: 32px;
    height: 32px;
    background-color: #ff0000; /* Rosso Errore */
    border-radius: 50%;
    color: white;
    font-size: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    border: 2px solid #800000; /* Bordo rosso scuro */
    box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
}

.error-message {
    font-size: 0.95rem;
    margin: 0;
    font-weight: bold;
}

.instruction {
    font-size: 0.85rem;
    margin: 0;
    color: #333;
}

/* 5. Il Bottone "Continua" (Stile Retro) */
.popup-btn {
    align-self: center;
    background-color: #c0c0c0;
    color: black;
    font-size: 14px;
    padding: 6px 25px;
    margin-bottom: 10px;
    cursor: pointer;
    
    /* BORDI 3D PER IL BOTTONE */
    border-top: 2px solid #fff;
    border-left: 2px solid #fff;
    border-right: 2px solid #000;
    border-bottom: 2px solid #000;
    outline: 1px solid transparent; /* Rimuove outline moderni */
    font-family: inherit;
}

/* Effetto premuto */
.popup-btn:active {
    border-top: 2px solid #000;
    border-left: 2px solid #000;
    border-right: 2px solid #fff;
    border-bottom: 2px solid #fff;
    transform: translate(1px, 1px);
}

.popup-btn:hover {
    box-shadow: inset 1px 1px 0 #fff;
}

/* =========================================
   MEDIA QUERY MOBILE (EFFETTO APP / FULL SCREEN)
   ========================================= */
@media (max-width: 900px) {
  
  /* 1. Blocchiamo il contenitore generale */
  .lobby-page {
    /* Su mobile usiamo height fissa viewport per evitare che la barra indirizzi crei scroll strani */
    height: 100dvh; 
    width: 100vw;
    overflow: hidden; /* Niente scroll sulla pagina "madre" */
    align-items: flex-start;
    padding: 0;
    background-color: #120220; /* Colore di sicurezza se l'immagine tarda */
  }

  /* 2. Il Layout diventa una colonna flessibile */
  .lobby-layout {
    display: flex;
    flex-direction: column;
    width: 100%;
    height: 100%; /* Occupa tutto lo spazio disponibile */
    
    border-radius: 0;
    border: none;
    box-shadow: none;
    padding: 10px; 
    gap: 8px; /* Gap ridotto leggermente per guadagnare spazio */
    
    /* Questo permette lo scroll interno se i contenuti sborano */
    overflow-y: auto; 
    overflow-x: hidden;
  }

  /* 3. ORDINE DEGLI ELEMENTI */
  
  /* A. Titolo Esterno (Piccolo in alto) */
  .lobby-header-external {
      margin-top: 2px;
      margin-bottom: 0;
      font-size: 0.7rem;
      flex-shrink: 0; 
  }

  /* B. Card Info e Bottoni (Compatta in alto) */
  .lobby-card {
    grid-column: auto;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem; /* Meno spazio tra gli elementi */
    order: 1; 
    
    background-color: transparent;
    border: none;
    padding: 0.5rem 0; /* Padding verticale ridotto */
    flex-shrink: 0; 
  }
  
  .lobby-info-group {
      align-items: center;
      text-align: center;
  }
  
  .room-name-display { font-size: 1.6rem; margin-bottom: 2px; }
  .lobby-room-code-container { justify-content: center; }

  /* Bottoni: una riga se ci stanno, altrimenti colonna */
  .lobby-buttons { 
      flex-direction: row; 
      width: 100%; 
      gap: 10px; 
      justify-content: center; 
  }
  
  /* Bottoni più compatti in altezza */
  .lobby-main-btn, 
  .lobby-main-btn.player-btn, 
  .lobby-main-btn.admin-btn { 
      width: 100%; 
      height: 48px; /* Altezza dito comoda */
      font-size: 1rem;
  }
  
  .lobby-main-btn.exit-btn {
      width: auto; /* L'exit button si adatta o diventa icona se vuoi */
      min-width: 80px;
      flex-shrink: 0;
  }

  /* C. Barra Status (Sottile) */
  .lobby-status-bar {
      order: 2;
      flex-shrink: 0;
      padding: 0;
      min-height: 20px;
  }
  
  .lobby-subtitle { font-size: 0.9rem; }

  /* D. Sidebar Giocatori (Espansa) */
  .lobby-sidebar {
    grid-column: auto;
    order: 3;
    background-color: #1f2022;
    padding: 10px;
    
    /* MODIFICA: Altezza fissa minima garantita per vedere ~4 giocatori */
    min-height: 180px; 
    
    /* Non la facciamo crescere troppo a discapito della chat */
    flex-grow: 0; 
    flex-shrink: 0;
    
    display: flex;
    flex-direction: column;
    border: 1px solid #333;
    border-radius: 8px;
  }
  
  .sidebar-players {
      /* Forza la comparsa della scrollbar se superi i 4 giocatori */
      max-height: 160px; 
      overflow-y: auto;
  }
  
  /* Player leggermente più compatti */
  .sidebar-player { padding: 8px; margin-bottom: 6px; }

  /* E. CHAT (Dominante in basso) */
  .lobby-chat-column {
    grid-column: auto;
    order: 4;
    
    /* FLEX MAGIC: Prende tutto lo spazio rimanente */
    flex: 1;          
    display: flex;
    flex-direction: column;
    
    /* Altezza minima garantita per vedere ~5 messaggi */
    min-height: 250px; 
    
    /* Margine inferiore per staccare dal bordo schermo (gestures iOS) */
    margin-bottom: 10px; 
  }
  
  .chat-container {
      height: 100%; 
      padding: 10px;
      display: flex;
      flex-direction: column;
      border: 1px solid #444;
  }

  /* F. Area Messaggi (Scrollabile ed Espansa) */
  .chat-messages {
      flex: 1;         
      height: 100%;    /* Forza l'altezza */
      min-height: 0;   /* Fix per flexbox scroll */
      overflow-y: auto;
  }
  
  .chat-input-form {
      margin-top: 10px;
      flex-shrink: 0;
  }
  
  /* Input chat più facile da tappare */
  .chat-input {
      height: 45px;
      font-size: 16px; /* Evita zoom automatico su iOS */
  }
  
  .chat-send-btn {
      width: 50px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
  }
}